{"version":3,"sources":["webpack:///webpack/bootstrap","webpack:///./lib-for-link/src/page/script/archives.js"],"names":["installedModules","__webpack_require__","moduleId","exports","module","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","ArchiveListUtils","openListYear","callback","console","log","li","$","zippy","addClass","removeClass","text","openListMonth","this","aList","document","querySelectorAll","loop","length","click","setTimeout","displayConfiguration","checkboxChange","attr","parent","find","prop","checked","yearLi","yearCheckbox","children","yearChecked","each","input","data","id","lscache","set","a","folderType","trim","linkParts","split","checkbox","change","before","loopOpenItem","linkList","openRetryCount","openWindow","win","window","open","waitCount","checkWinClosed","closed","close","startDownload","checkedList","loopChecklist","eq","hasClass","ele","push","href","pageTool"],"mappings":"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","file":"page.js","sourcesContent":[" \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 58);\n","ArchiveListUtils = {\n  openListYear: function (callback) {\n    console.log('openListYear')\n    //$(\"#BlogArchive1_ArchiveList > ul.hierarchy > li.archivedate:not(.expanded) a.toggle:eq(0)\").trigger(\"click\")\n    let li = $(\"#BlogArchive1_ArchiveList > ul.hierarchy > li.archivedate:not(.expanded)\")\n    let zippy = $(\"#BlogArchive1_ArchiveList > ul.hierarchy > li.archivedate:not(.expanded) > a.toggle > .zippy:not(.toggle-open)\")\n    li.addClass(\"expanded\").removeClass('collapsed')\n    zippy.addClass('toggle-open').text('▼ ')\n    \n    if (typeof(callback) === 'function') {\n      callback()\n    }\n  },\n  openListMonth: function (callback) {\n    //console.log('openListMonth')\n    \n    //let li = $(\"#BlogArchive1_ArchiveList > ul.hierarchy > li.archivedate > ul.hierarchy > li.archivedate.collapsed\")\n    //console.log(111)\n    this.openListYear(() => {\n      //console.log(document.querySelectorAll(\"ul > li > ul > li.archivedate.collapsed > a.toggle\").length)\n      // 請溫柔地開它\n      let aList = document.querySelectorAll(\"#BlogArchive1_ArchiveList > ul > li > ul > li.archivedate.collapsed > a.toggle\")\n      let loop = (i) => {\n        if (i < aList.length) {\n          aList[i].click()\n          $(() => {\n            setTimeout(() => {\n              i++\n              loop(i)\n            }, 500)\n          })\n        }\n        else {\n          if (typeof(callback) === \"function\") {\n            callback()\n          }\n        }\n      }\n      loop(0)\n    })\n  },\n  displayConfiguration: function () {\n    console.log('displayConfiguration')\n    let cacheKey = 'archivesCheckboxStatus'\n    \n    this.openListYear(() => {\n      \n      // -------------------------------\n      \n      let checkboxChange = function () {\n        // 要先確認自己是位於那個階層\n        let folderType = $(this).attr('data-folder-type')\n        //console.log(folderType)\n        \n        if (folderType === 'year') {\n          // 強迫它底下的所有checkbox都check\n          //console.log(this.checked)\n          //console.log($(this).find('.download-checkbox').length)\n          /*\n          let checked = 'checked'\n          if (this.checked === false) {\n            checked = false\n          } \n          */\n          let checkboxList = $(this).parent().find('ul > li > .download-checkbox')\n          //console.log(checkboxList.length)\n          //console.log(checked)\n          checkboxList.prop('checked', this.checked)\n        }\n        else {\n          // 檢查上面一層底下的所有狀態，有跟自己不一樣的就移除上層的打勾\n          let yearLi = $(this).parent().parent().parent()\n          //console.log(yearLi.prop('className'))\n          let yearCheckbox = yearLi.children('.download-checkbox')\n          \n          let yearChecked = true\n          yearLi.find('ul.hierarchy > li > .download-checkbox').each((i, input) => {\n            if (input.checked === false) {\n              yearChecked = false\n            }\n          })\n          yearCheckbox.prop('checked', yearChecked)\n        }\n        \n        // -------------------------------------\n        // 儲存狀態\n        let data = {}\n        $('#BlogArchive1_ArchiveList input.download-checkbox').each((i, input) => {\n          data[input.id] = input.checked\n        })\n        lscache.set(cacheKey, data)\n      }\n      \n      // -------------------------------------\n      \n      $('#BlogArchive1_ArchiveList a.toggle').each((i, a) => {\n        // 查看一下現在的狀態，然後加上年月好嗎\n        let folderType = 'month'\n        if ($(a).parent().parent().parent().attr('id') === 'BlogArchive1_ArchiveList') {\n          folderType = 'year'\n        }\n        \n        let value\n        if (folderType === 'year') {\n          value = 'd_' + $(a).parent().children('a.post-count-link').text().trim()\n        }\n        else {\n          let link = $(a).parent().children('a.post-count-link').attr('href')\n          let linkParts = link.split('/')\n          value = 'd_' + linkParts[(linkParts.length - 3)] + '_' + linkParts[(linkParts.length - 2)]\n        }\n        \n        let checkbox = $('<input type=\"checkbox\" checked=\"checked\" class=\"download-checkbox\" />')\n                .attr('id', value)\n                .attr('data-folder-type', folderType)\n                .change(checkboxChange)\n        $(a).before(checkbox)\n                .parent().addClass('init-download-checkbox')\n      })\n      \n      // --------------------------------\n      // 讀取狀態\n      let data = lscache.get(cacheKey)\n      if (data) {\n        for (let id in data) {\n          $('#' + id).prop('checked', data[id])\n        }\n      }\n    }) \n  },\n  \n  // ------------------------------------------------------------------\n  loopOpenItem: function (linkList, callback) {\n    let loop = (i) => {\n      if (i < linkList.length) {\n        let openRetryCount = 3\n        let openWindow = () => {\n          let win = window.open(linkList[i])\n\n          // 這邊要等待它關閉\n          let waitCount = 60 * 5\n          let checkWinClosed = () => {\n            if (win.closed === false && waitCount > 0) {\n              setTimeout(() => {\n                waitCount--\n                checkWinClosed()\n              }, 1000)\n            }\n            else {\n              if (waitCount === 0) {\n                // 五分鐘都沒關閉，一定有問題\n                win.close()\n                \n                openRetryCount--\n                if (openRetryCount > 0) {\n                  openWindow()\n                  return\n                }\n                console.log(['DOWNLOAD ERROR', linkList[i]])\n              }\n\n              setTimeout(() => {\n                i++\n                loop(i)\n              }, 3000)\n            }\n          }\n          checkWinClosed()\n        }\n        \n        openWindow()\n      }\n      else {\n        if (typeof(callback) === 'function') {\n          callback()\n        }\n      }\n    }\n    loop(0)\n    \n    \n  },\n  startDownload: function (callback) {\n    //console.log('startDownload')\n    \n    let checkedList = $('#BlogArchive1_ArchiveList input.download-checkbox[data-folder-type=\"month\"]:checked')\n    let loopChecklist = (i) => {\n      if (i < checkedList.length) {\n        let li = checkedList.eq(i).parent()\n        if (li.hasClass('collapsed')) {\n          // 要先點開\n          li.children('a.toggle')[0].click()\n          setTimeout(() => {\n            loopChecklist(i)\n          }, 1000)\n        }\n        else {\n          // 已經點開了\n          let linkList = []\n          li.find('ul.posts > li > a').each((i, ele) => {\n            linkList.push(ele.href + '?downloadArticle=true')\n          })\n          \n          // 那我們逐一點開吧\n          this.loopOpenItem(linkList, () => {\n            checkedList.eq(i).prop('checked', false).change()\n            i++\n            loopChecklist(i)\n          })\n        }\n        \n      }\n      else {\n        if (typeof(callback) === 'function') {\n          callback()\n        }\n      }\n    }\n    loopChecklist(0)\n  }\n}\n\n$(() => {\n  let pageTool = $('#ArchiveList > .page-tool')\n  pageTool.find('.open-list.year').click(() => {\n    ArchiveListUtils.openListYear()\n  })\n  pageTool.find('.open-list.month').click(() => {\n    ArchiveListUtils.openListMonth()\n  })\n  pageTool.find('.setup-checkbox').click(() => {\n    ArchiveListUtils.displayConfiguration()\n  }).click()\n  pageTool.find('.start-download').click(() => {\n    ArchiveListUtils.startDownload()\n  })\n})"],"sourceRoot":""}